# 参数说明文档

## 目录
1. [质控参数](#质控参数)
2. [预处理参数](#预处理参数)
3. [聚类参数](#聚类参数)
4. [HDWGCNA参数](#hdwgcna参数)
5. [富集分析参数](#富集分析参数)

---

## 质控参数

### min_genes
- **说明**: 每个细胞保留的最小基因数
- **默认值**: 200
- **适用范围**: 100-500
- **建议**: 对于动物细胞通常为200，对于植物细胞可适当提高
- **如何调整**: 
  - 若过滤掉太多细胞，可降低此值
  - 若想保留更高质量细胞，可提高此值

### max_genes
- **说明**: 每个细胞保留的最大基因数
- **默认值**: 5000
- **适用范围**: 3000-10000
- **建议**: 用于移除可能的多细胞聚集体或质量异常的细胞
- **如何调整**:
  - 若想保留更多基因丰富的细胞，可提高此值
  - 若想排除多细胞或质量问题的样本，可降低此值

### min_counts / max_counts
- **说明**: 每个细胞的最小/最大UMI数
- **默认值**: min=300, max=50000
- **说明**: UMI（Unique Molecular Identifier）代表测序覆盖深度
- **如何调整**:
  - 样本UMI数分布可通过QC检查确定
  - 参考：`plt.hist(adata.obs['total_counts'])`

### mt_percent_threshold
- **说明**: 线粒体基因比例阈值
- **默认值**: 10 (%)
- **适用范围**: 5-20%
- **生物学意义**: 高线粒体比例可能表示细胞压力或破裂
- **如何调整**:
  - 植物细胞的线粒体比例通常较低
  - 可参考质控图后调整：`plt.hist(adata.obs['pct_counts_mt'])`

### remove_mt
- **说明**: 是否移除线粒体基因
- **默认值**: false
- **说明**: 移除线粒体基因后可改善聚类结果
- **建议**: 通常不建议移除，而是在聚类前选择移除

---

## 预处理参数

### normalization
- **说明**: 正规化方法
- **选项**:
  - `log1p`: 对数转换（推荐）
  - `logcpm`: CPM标准化后对数转换
  - `scran`: 更复杂的方法（需要额外库）
- **默认值**: "log1p"

### n_top_genes
- **说明**: 选择高变基因的数量
- **默认值**: 2000
- **适用范围**: 1000-5000
- **建议**: 
  - 对于小型数据集（<5000细胞）：1000-2000
  - 对于中型数据集（5000-50000细胞）：2000-3000
  - 对于大型数据集（>50000细胞）：3000-5000
- **效果**: 基因数越多，保留的信息越多，但计算时间越长

### use_hvg
- **说明**: 是否仅使用高变基因进行后续分析
- **默认值**: true
- **说明**: 建议为true，可提高聚类准确性

---

## 聚类参数

### resolution
- **说明**: Leiden聚类的分辨率参数
- **默认值**: 0.8
- **适用范围**: 0.4-2.0
- **含义**: 值越大，检测到的簇越多
- **推荐值**:
  - 细胞类型少（2-5种）：0.4-0.6
  - 细胞类型中等（5-20种）：0.6-1.0
  - 细胞类型复杂（>20种）：1.0-1.5
- **如何选择**: 
  ```python
  # 尝试多个分辨率
  for res in [0.4, 0.6, 0.8, 1.0, 1.2]:
      sc.tl.leiden(adata, resolution=res, key_added=f'leiden_r{res}')
  # 观察各分辨率下的聚类结果
  ```

### n_neighbors
- **说明**: KNN算法中的邻居数
- **默认值**: 15
- **适用范围**: 10-30
- **建议**:
  - 样本数少（<1000）：10-15
  - 样本数多（>10000）：15-30
- **效果**: 邻居数越多，聚类更平滑；越少，更容易保留局部结构

---

## HDWGCNA参数

### soft_power
- **说明**: 软功率参数
- **默认值**: 6
- **适用范围**: 3-12（取决于无标度拓扑适应度R²）
- **选择方法**:
  ```python
  # 测试软功率
  powers = list(range(1, 21))
  sft = chooseSoftThreshold(expr_data, powerVector=powers)
  # 选择R² > 0.8且平均连接度不过低的最小值
  ```
- **植物样本**: 通常为6-8

### min_module_size
- **说明**: 最小模块大小
- **默认值**: 30
- **适用范围**: 20-50
- **建议**:
  - 基因数多（>10000）：30-50
  - 基因数少（<5000）：20-30
- **效果**: 较小的值可检测到更多小模块

### merge_threshold
- **说明**: 模块相似性合并阈值
- **默认值**: 0.25
- **适用范围**: 0.15-0.4
- **含义**: 相关性>此阈值的模块会被合并
- **建议**: 降低此值可保留更多独立模块

### network_type
- **说明**: 网络构建类型
- **选项**:
  - `signed`: 有符号网络（推荐，区分正负相关）
  - `unsigned`: 无符号网络（不区分相关方向）
- **默认值**: "signed"

---

## 富集分析参数

### GO参数

#### ontology
- **说明**: 基因本体类型
- **选项**:
  - `BP`: Biological Process（生物过程）
  - `CC`: Cellular Component（细胞成分）
  - `MF`: Molecular Function（分子功能）
- **默认值**: ["BP", "CC", "MF"]
- **建议**: 通常都分析，但可根据需要选择

#### pvalue_threshold
- **说明**: p值阈值
- **默认值**: 0.05
- **说明**: p < 此值被认为显著

#### qvalue_threshold
- **说明**: 校正p值（q值）阈值
- **默认值**: 0.1
- **说明**: q < 此值被认为显著（推荐使用q值）

### KEGG参数

#### organism
- **说明**: 物种代码
- **常见值**:
  - `ath`: 拟南芥 (Arabidopsis thaliana)
  - `osa`: 水稻 (Oryza sativa)
  - `zma`: 玉米 (Zea mays)
  - `bra`: 芜菁 (Brassica rapa)
  - `sly`: 番茄 (Solanum lycopersicum)
- **获取完整列表**: 查看KEGG官网

#### pvalue_threshold / qvalue_threshold
- **说明**: 同GO参数
- **默认值**: 0.05 / 0.1

### 通用参数

#### min_gene_set_size
- **说明**: 富集基因集的最小基因数
- **默认值**: 5
- **建议**: 较高的值（如10-15）可避免太小的基因集

#### max_gene_set_size
- **说明**: 富集基因集的最大基因数
- **默认值**: 500
- **建议**: 用于过滤太大的通用基因集

---

## 计算资源参数

### n_jobs
- **说明**: 使用的CPU线程数
- **默认值**: -1
- **说明**: -1表示使用全部可用CPU
- **推荐值**:
  - 个人电脑：2-4
  - 工作站：8-16
  - 服务器：-1（全部）

### use_gpu
- **说明**: 是否使用GPU加速
- **默认值**: false
- **要求**: 需要NVIDIA GPU和CUDA支持
- **支持库**: CuPy、Tensorflow等

---

## 快速参考表

| 参数 | 小数据集 | 中等数据集 | 大数据集 |
|------|---------|----------|---------|
| n_top_genes | 1000 | 2000 | 3000 |
| resolution | 0.6 | 0.8 | 1.0 |
| n_neighbors | 10 | 15 | 20 |
| soft_power | 5 | 6 | 7 |
| min_module_size | 20 | 30 | 40 |

---

**最后更新**: 2026年1月14日
